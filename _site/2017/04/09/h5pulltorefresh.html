<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>H5下拉刷新,多种皮肤，便于拓展！ | Dailc的个人主页</title>
    <meta name="author" content="dailc" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="Everything about dailc" />
    <meta name="baidu-site-verification" content="cVrw8PsZv7" />
    <meta name="keywords" content="dailc,戴荔春,戴荔春的博客,dailc的博客" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
  	<link href="/asserts/css/default.css" rel="stylesheet" type="text/css" media="all">
	<script type="text/javascript" src="/asserts/js/app.js" ></script> 
</head>
<body>
	<!--头部 -->
	<header class="header">
		<div class="header-container">
			<section class="site-logo">
				<a  href="/">撒网要见鱼</a>
			</section>
			<button class="collapsed " type="button" >
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		        <span class="icon-bar"></span>
		    </button>
		    <div class="menu-container">
				<nav class="site-nav">
					<ul>
						<li>
							<a  href="/blog/archiveAll.html">随笔</a>
						</li>
						<li>
							<a  href="/blog/archive.html">博客</a>
						</li>
						<li>
							<a  href="/blog/categories.html">分类</a>
						</li>
						<li>
							<a  href="/blog/tags.html">标签</a>
						</li>
						<li>
							<a  href="/demo/demo.html">Demo</a>
						</li>
						<li>
							<a  href="/favour/music.html">音乐</a>
						</li>
						<li>
							<a  href="/favour/book.html">Book</a>
						</li>
						<li>
							<a  href="/about/timeline.html">时间轴</a>
						</li>
						<li>
							<a  href="/others/collection.html">收藏</a>
						</li>
						<li>
							<a  href="/about/about.html">关于</a>
						</li>
					</ul>
				</nav>
				<div class="site-search">
					<input type="text" />
				</div>
			</div>
		</div>
	</header>
	<link href="/asserts/css/blog_article_post.css" rel="stylesheet" type="text/css" media="all">
<link href="/asserts/css/blog_personCard_style.css" rel="stylesheet" type="text/css" media="all">
<link href="/asserts/css/imageBubble.css" rel="stylesheet" type="text/css" media="all">
	
	<div class="wrap">
		<div class="container">
			<!-- 左侧，内容，多说评论等-->
			<div class="col-md-9">
				<!-- 内容-->
				<div class="markdown-body">
					<!--标题区域 -->
					<div class="title-container">
					<h1 class="page-title"><a  title="H5下拉刷新,多种皮肤，便于拓展！">H5下拉刷新,多种皮肤，便于拓展！</a> </h1>
						<!-- metainfo-->
						<section class="meta clearfix">
<span class="time">
<time datetime="2017-04-09">2017-04-09</time>
</span>

| 
<span class="categories">
	分类
	    
	    <a href="/blog/categories.html#blog" title="blog">blog</a>&nbsp;
	    
</span>


| 
<span class="tags">
	标签
		
		<a href="/blog/tags.html#下拉刷新" title="下拉刷新">下拉刷新</a>&nbsp;
		
		<a href="/blog/tags.html#h5" title="h5">h5</a>&nbsp;
		
</span>

| 
<span class="views">
	浏览
	<a id="busuanzi_value_page_pv"></a>&nbsp;
</span>
</section>
						<section class="right-tips">
							<span >
								下拉刷新
							</span>
						</section>
					</div>
					<!-- 特别推荐-->
					
					<!-- 内容区域-->
					<div class="content-container">
						 <h2 id="前言">前言</h2>
<p>下拉刷新几乎是移动H5端必用的插件，本人自踏入前端坑以来，第一个封装的h5插件也是下拉刷新，近来正好在整理下拉刷新相关知识，因此重新弄了一个下拉刷新库，统一了API，抽取了基类，提供了各式各样的皮肤，以及支持进行自定义皮肤的定制。</p>

<h2 id="题纲">题纲</h2>

<ul>
  <li>多种皮肤效果展示</li>
  <li>有何特点</li>
  <li>架构介绍</li>
  <li>如何拓展自定义皮肤</li>
  <li>API与使用</li>
  <li>是否依赖第三方库</li>
  <li>使用场景</li>
  <li>示例与源码</li>
</ul>

<h2 id="多种皮肤效果展示">多种皮肤效果展示</h2>
<p>提供了多种皮肤样式供选择。</p>

<ul>
  <li>效果1
<img src="https://dailc.github.io/pullToRefresh-h5-iscroll/staticresource/img/effect1.gif" alt="" /></li>
  <li>效果2
<img src="https://dailc.github.io/pullToRefresh-h5-iscroll/staticresource/img/effect2.gif" alt="" /></li>
  <li>效果3
<img src="https://dailc.github.io/pullToRefresh-h5-iscroll/staticresource/img/effect3.gif" alt="" /></li>
  <li>效果4
<img src="https://dailc.github.io/pullToRefresh-h5-iscroll/staticresource/img/effect4.gif" alt="" /></li>
  <li>效果5
<img src="https://dailc.github.io/pullToRefresh-h5-iscroll/staticresource/img/effect5.gif" alt="" /></li>
  <li>效果6
<img src="https://dailc.github.io/pullToRefresh-h5-iscroll/staticresource/img/effect6.gif" alt="" /></li>
</ul>

<h2 id="有何特点">有何特点</h2>
<p>这个下拉刷新库的最大特点就是:</p>

<ul>
  <li>UI与核心逻辑分层</li>
  <li>统一API</li>
  <li>便于拓展</li>
</ul>

<p>之前在封装这个库之前就尝试找过一些H5下拉刷新的实现，但是大多都是代码比较乱，或者是依赖了第三方库，达不到自己的预期。因此这次另起炉灶重新封装了一个，里面默认就提供了多个皮肤的实现，最重要的是，由于将UI实现剥离出来了，因此可以很方便的进行自定义皮肤的拓展，只需要实现特定的UI函数，即可在里面定义自己的皮肤。</p>

<h2 id="架构介绍">架构介绍</h2>
<p>下拉刷新基于IScroll实现，为了便于拓展与维护，将这个下拉刷新库分成了以下架构:</p>

<ul>
  <li><code class="highlighter-rouge">IScrollProbe</code>-下拉刷新是基于IScroll实现的</li>
  <li><code class="highlighter-rouge">PullToRefreshCore</code>-下拉刷新的基类，里面控制下拉刷新的核心交互逻辑(比如何时下拉，何时上拉等)</li>
  <li><code class="highlighter-rouge">PullToRefreshSkin</code>-下拉刷新的皮肤(UI实现类)，里面只关心UI的实现，只在特定的回调中进行UI渲染即可，这样可以减少耦合，正常情况下，这一层的下拉刷新就已经能对外使用了</li>
  <li><code class="highlighter-rouge">PullToRefreshBizlogic</code>-这个是业务层(专门针对项目快速开发二次封装的)，仅仅是将一些常用操作再次封装而已(譬如ajax等)，不要这一层也能正常运行</li>
</ul>

<h2 id="如何拓展自定义皮肤">如何拓展自定义皮肤</h2>
<p>封装出来的下拉刷新Core中进行逻辑判断，这里面暴露了一些对应的UI hook，皮肤类只需要继承Core类，并实现这些UI hook即可完成一个自定义的皮肤(所有的skin都是共用一套下拉刷新逻辑的，只是各自的UI实现不同而已)。可供实现的UI hook如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>* _initPullToRefreshTipsHook() //在这里初始化生成下拉刷新与上拉加载的提示
* _pullingHook(deltaY,thresholdHeight) //下拉过程中的钩子函数，方便实现一些渐变动画
* _pulldownLoaingAnimationHook //下拉刷新的动画
* _pulldownLoaingAnimationSuccessHook(done,isSuccess) //下拉刷新的成功动画-动画完毕后可能的成功提示,没有的话请直接执行done
* _pulldownLoaingAnimationEndHook //下拉刷新的动画完成后的回调，可以用来重置状态
* _pullupLoaingAnimationHook(isFinished) //上拉加载的动画
* _pullupLoaingAnimationSuccessHook(isFinished) //上拉加载的成功动画-动画完毕后可能的成功提示，或者重置状态
* _scrollEndHook //滑动完毕后的end回调(这个比较少用到)
* _enablePullUpHook //允许pullup后的回调
* _disablePullUpHook //禁止pullup后的回调
</code></pre>
</div>
<p><strong>最简单的情况下，只需要参考其它皮肤，继承Core类，哪怕这些hook都没有实现，也会有下拉刷新功能的</strong>(只是如果不实现，则不会有相应的UI动画而已)</p>

<h2 id="api与使用">API与使用</h2>
<p>下拉刷新API是由基类统一对外提供的，所以所有的下拉刷新皮肤都有统一的API，如下:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	* finished //这是一个属性，用来控制当前上拉加载是否可用
	* refresh() //重置状态。譬如上拉加载关闭后需要手动refresh重置finished状态
	* pulldownLoading() //主动触发一个下拉刷新的动画(同时会触发下拉回调)
	* pullupLoading() //主动触发一个上拉加载的动画(同时会触发上拉回调)
	* endPullDownToRefresh() //关闭下拉刷新动画，重置状态
	* endPullUpToRefresh(finished) //关闭上拉加载动画，重置状态，如果finished，则不允许在上拉，除非再次refresh()
</code></pre>
</div>
<p>关于使用，遵循了一个原则就是:</p>

<ul>
  <li>所有的下拉刷新有统一的Dom结构与JS调用方式</li>
  <li>方便的替换皮肤(更改皮肤只需要更改对应引入的文件与变量即可)</li>
</ul>

<p>关于更多的使用说明可以参考源码中的README</p>

<h2 id="是否依赖第三方库">是否依赖第三方库</h2>
<p>下拉刷新只依赖于<code class="highlighter-rouge">IScroll5-Probe</code>，不依赖与其它任何文件(特例下方会有说明)</p>

<h3 id="关于一些有特别依赖的特例">关于一些有特别依赖的特例</h3>
<p>正常的下拉刷新只基于IScroll5的，但是有一些例外情况也依赖了其它文件</p>

<ul>
  <li>有一两个皮肤的实现依赖了<code class="highlighter-rouge">mui.css</code>-如果不想依赖只需要把对应样式拿出来即可</li>
  <li>有一个下拉刷新业务实现类依赖了<code class="highlighter-rouge">mui.js</code>，这个是项目中用到的，正常情况下如果不是基于mui.js的项目，别用它就是了</li>
  <li>一些专门基于mui拓展的皮肤是基于<code class="highlighter-rouge">mui.js</code>的(同上，这也只是在基于mui开发时的便捷封装而已)</li>
</ul>

<p>简单的说，下拉刷新仅仅依赖于一个<code class="highlighter-rouge">IScroll5</code>库，一些专门为项目二次封装的文件才会去依赖于其它库。(说明下，这里的<code class="highlighter-rouge">IScroll5</code>是进过了一点点改造的，增加了一些功能，但是不影响原有使用)</p>

<p>更多的说明可以参考源码中的README</p>

<h2 id="使用场景">使用场景</h2>
<p>这次之所以会封装这个库，起由是:
以前项目中用到了一个下拉刷新效果，现在需要更换成一个新效果(同时也考虑到以后可能会换新的效果)，因此将下拉刷新的底层实现与UI从业务中剥离了出来，这样更换皮肤时，只需要更改下引用的皮肤即可，外部的业务代码都无需变动。</p>

<p>另外，这次实现多个不同皮肤时，有的是用的最简单的状态切换，有的用了<code class="highlighter-rouge">canvas</code>动画，有的用了<code class="highlighter-rouge">css3动画</code>，最后发现在一些机型上，复杂的动画还是会很卡，因此如果考虑低端机型的话，还是用简单一点的实现吧。</p>

<p>所以，后续的皮肤拓展也会是在这个思路上进行，譬如考虑更好的背景图，图标，交互等效果替换，而不是使用那些炫酷的渐变动画。</p>

<h2 id="示例与源码">示例与源码</h2>
<p>源码与示例请参考<code class="highlighter-rouge">github</code>地址:</p>

<p><a href="https://github.com/dailc/pullToRefresh-h5-iscroll">https://github.com/dailc/pullToRefresh-h5-iscroll</a></p>

<p>或者可以戳这里看下示例页面:
<a href="https://dailc.github.io/pullToRefresh-h5-iscroll/examples/html/">https://dailc.github.io/pullToRefresh-h5-iscroll/examples/html/</a></p>

					</div>
					<!-- 上一篇与下一篇-->
					<section align="right" class="post-next-prev">
					  <span>
					    <a  href="/2017/04/04/bookReview_JaneEyre.html" class="active"  >上一篇</a>
					    &nbsp;&nbsp;&nbsp;
					    <a  href="/2017/04/11/bookReview_thePhantomOfTheOpera.html" class="active"  >下一篇</a>
					  </span>
					</section>
				</div>
				<!-- 多说-->
				
<!--多说评论 -->
<div id="duoshuo-container">
<!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="http://localhost:4000/2017/04/09/h5pulltorefresh.html}" data-title="H5下拉刷新,多种皮肤，便于拓展！" data-url="http://localhost:4000/2017/04/09/h5pulltorefresh.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"dailc"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
<!-- 多说公共JS代码 end -->
</div>

				
				
			</div>
			
			<!-- 右侧包括个人介绍，TOC菜单-->
			<div class="col-md-3">
				<!-- 右侧人物面板-->
				<div class="effect1 person-card">
					
				 	<a  class="member-image">
				 			<img src="/asserts/images/img_avatar.jpg" alt="Lichun Dai"/>
				 	</a>
				 	<div class="member-info">
				 		<p class="info-name">
				 		<a >
				 			Lichun Dai
				 		</a>
				 		</p>
				 		<p>
				 			单线程生物，无法同时专注于多件事情。做自己感兴趣的工作，目前偏爱前端。业余爱好:口琴、吉他。
				 		</p>
				 	<p class="info-foot">
				 		<a class="left-card left" href="/blog/archive.html">
				 			<em>
				 				博客
				 			</em>
				 			<strong>
				 				28
				 				
				 			</strong>
				 		</a>
				 		<a class="middle-card left" href="/demo/demo.html">
				 			<em>
				 				项目
				 			</em>
				 			<strong>
				 				2
				 			</strong>
				 		</a>
				 		<a class="right-card left" href="/blog/archiveAll.html">
				 			<em>
				 				随笔
				 			</em>
				 			<strong>
				 				58
				 			</strong>
				 		</a>
				 	</p>
				 	<p class="info-social-touch">
				 		<a target="_blank" href="https://github.com/dailc" ><img src="/asserts/images/icons/favicon_github.ico" alt="GitHub"/> </a>
						<a target="_blank" href="http://5sing.kugou.com/54188866/default.html"><img src="/asserts/images/icons/favicon_5sing.ico" alt="5sing" /> </a>	
						<a target="_blank" href="http://changba.com/u/200945262"><img src="/asserts/images/icons/favicon_changba.ico" alt="唱吧" /> </a>
						<a target="_blank" href="https://www.zhihu.com/people/dailichun"><img src="/asserts/images/icons/favicon_zhihu.ico" alt="知乎" /> </a>
						<a target="_blank" href="http://www.jianshu.com/u/c104d2a4baec"><img src="/asserts/images/icons/favicon_jianshu.ico" alt="简书" /> </a>
				 	</p>
				 	</div>
				</div>

				 <!-- TOC动态菜单-->
				  <div class="slideNavContainer">     
				</div> 				
					
			</div> 
 
		</div>
	</div>
		
<script type="text/javascript" src="/asserts/js/post.js" ></script>
<script type="text/javascript" src="/asserts/js/imageBubble.js" ></script>
<script>
	ImageBubble.init('.container img');
</script>
	
	<!-- 脚步,包括版权声明，访问次数等-->
	<footer class="footer">
	    <p class="copyright">
	    	<small>
	            <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/cn/" target="_blank" title="许可协议">©</a> 2016&nbsp;&nbsp;&nbsp;&nbsp;<a href="/about/">Lichun Dai</a>
	        </small>
	    </p>
	    <p class="more-tips">
	    	<span>Powered by Jekyll</span>&nbsp;&nbsp;&nbsp;&nbsp;
	    	<span id="busuanzi_container_site_pv">总访客<span id="busuanzi_value_site_uv" class="site-uv"></span>人</span>&nbsp;&nbsp;&nbsp;&nbsp;
	    	<span id="busuanzi_container_site_pv">总访问<span id="busuanzi_value_site_pv" class="site-pv"></span>次</span>
	    </p>  
	</footer>

<script>
//百度统计
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cf8506e0ef223e57ff6239944e5d46a4";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<!--不蒜子 -->
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



</body>
</html>
